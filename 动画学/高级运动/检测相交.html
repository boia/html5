<!doctype html5>
<html>
<head>
	<meta charset=gbk>
	<style>
		*{margin:0;padding:0;}
		canvas{border:1px solid red;}
	</style>
</head>
<body>
	<canvas id="mycanvas" width="1278px" height="683px"></canvas>

	<script>
		var mycanvas = document.getElementById("mycanvas");
		var ctx = mycanvas.getContext("2d");

		function addEvent(obj,event,fuc){
			if(obj.addEventListener){
				obj.addEventListener(event,fuc);
				
			}
			else if(obj.attachEvent){
				obj.attachEvent("on"+event,function(event){
									//使作用域指向obj(事件对象)
									return fuc.call(obj,event);
								});
			}
		}
		
		var Stage = function(){
			this.self = mycanvas;
			this.width = this.self.offsetWidth;
			this.height = this.self.offsetHeight;
			
		};

		var Point = function(x,y){
			this.x = x;
			this.y = y;
		};

		Stage.prototype.addEvent = function(type,fuc){
			addEvent(this.self,type,fuc);
		};
		
		//定义一个球的类
		var Ball = function(context,x,y,radius,color){
			if(!radius) radius = 20;
			if(!color) color = "red";
			if(!context) context = ctx;
			if(!x) x = mycanvas.offsetWidth/2;
			if(!y) y = mycanvas.offsetHeight/2;

			this.context = context;
			this.x = x;
			this.y = y;
			this.radius = radius;
			this.color = color;
			this.stage = new Stage();

			this.vx = 0;			
			this.vy = 0;

			this.init();
		};

		Ball.prototype.init = function(){
			this.context.fillStyle = this.color;
			this.context.beginPath();

			this.context.moveTo(200,0);
			this.context.lineTo(200,600);
			this.context.moveTo(0,300);
			this.context.lineTo(800,300);
			this.context.stroke();
			this.context.beginPath();
			this.context.arc(this.x,this.y,this.radius,0,2*Math.PI);
			this.context.strokeRect(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius);
			this.context.fill();
		};

		//检测俩矩形是否相交
		Ball.prototype.hitTestObject = function(ob){
			return ((this.y+this.radius) >= (ob.y-ob.radius)) &&
					((this.x+this.radius) >= (ob.x-ob.radius)) &&
					((ob.y+ob.radius) >= (this.y-this.radius)) &&
					((ob.x+ob.radius) >= (this.x-this.radius)) ;
		};
		
		//检测点和矩形的相交
		Ball.prototype.hitTestPoint = function(point){
			return (point.x >= (this.x-this.radius)) && 
				   (point.x <= (this.x+this.radius)) &&
				   (point.y >= (this.y-this.radius)) && 
				   (point.y <= (this.y+this.radius));
		};

		var CheckTouch = function(){
			this.balls = [];
			this.num = 2;
			this.context = ctx;
			this.stage = new Stage();

			this.init();
		};

		CheckTouch.prototype.init = function(){
			for(var i=0;i<this.num;i++){
				var vx = 10*Math.random()-5;			
				var vy = 10*Math.random()-5;
				var radius = 35*Math.random()+10;
				var x = (this.stage.width-2*radius)*Math.random()+radius;
				var y = (this.stage.height-2*radius)*Math.random()+radius;
				

				var ball = new Ball("",x,y,radius);

				ball.vx = vx;
				ball.vy = vy;

				this.balls.push(ball);
				
			}
		};

		CheckTouch.prototype.move = function(){
			this.context.clearRect(0,0,this.stage.width,this.stage.height);
			
			for(var i=0;i<this.num;i++){			
				
				if(this.balls[i].y+this.balls[i].radius > this.stage.height || this.balls[i].y - this.balls[i].radius < 0){
					this.balls[i].vy *= -1;
				}
				if(this.balls[i].x+this.balls[i].radius > this.stage.width || this.balls[i].x - this.balls[i].radius < 0){
					this.balls[i].vx *= -1;
				}

				this.balls[i].x += this.balls[i].vx;
				this.balls[i].y += this.balls[i].vy;


				this.balls[i].init();
			}
			if(this.balls[1].hitTestObject(this.balls[0])){
				//alert("撞到了");
			}
			if(this.balls[0].hitTestPoint(new Point(200,300))){
				alert(this.balls[0].x+":"+this.balls[0].y);
				//alert("撞到点了");
			}
		};

		//CheckTouch.prototype.hitTestObject = function(ob){
			
		//};

		var balls = new CheckTouch();

		
		setInterval(function(){balls.move();},33);	

	</script>
</body>
</html>